<!doctype html>
<html lang="es">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Calculadora de Riesgo</title>

<style>
:root{
  --brand:#0057B8;
  --brand-dark:#003E84;
  --brand-soft:#EAF2FF;
  --accent:#7FBBED;

  --low:#16a34a;
  --med:#fbbf24;
  --high:#f97316;  /* ALTO naranja */
  --crit:#dc2626;  /* CRITICO rojo */

  --border:rgba(0,0,0,.08);
  --muted:#6B7280;
}

body{
  margin:0;
  font-family:Segoe UI, sans-serif;
  background: radial-gradient(1200px 500px at 10% 0%, rgba(0,87,184,.25), transparent 60%), var(--brand-soft);
}

.topbar{
  height:55px;
  background:linear-gradient(90deg,var(--brand-dark),var(--brand));
}

.wrap{
  max-width:1300px;
  margin:auto;
  padding:20px;
}

h1{
  color:var(--brand);
  margin:0;
}

.card{
  background:#fff;
  padding:16px;
  border-radius:16px;
  border:1px solid var(--border);
  box-shadow:0 8px 25px rgba(0,0,0,.05);
  margin-bottom:14px;
}

.row{
  display:grid;
  grid-template-columns:1fr 1fr;
  gap:12px;
}

.row3{
  display:grid;
  grid-template-columns:1fr 1fr 1fr;
  gap:12px;
}

input,select,textarea{
  width:100%;
  padding:10px;
  border-radius:12px;
  border:1px solid var(--border);
}

textarea{min-height:80px;}

button{
  padding:10px 14px;
  border-radius:12px;
  border:1px solid var(--border);
  background:#fff;
  cursor:pointer;
  font-weight:bold;
}

button.primary{
  background:linear-gradient(90deg,var(--brand),var(--accent));
  color:#fff;
  border:none;
}

button.danger{
  background:#fee2e2;
  color:#7f1d1d;
}

.pill{
  display:inline-flex;
  align-items:center;
  gap:6px;
  padding:8px 12px;
  border-radius:999px;
  border:1px solid var(--border);
  background:#f3f4f6;
}

.dot{
  width:10px;
  height:10px;
  border-radius:50%;
  background:#94a3b8;
}

.box{
  border:1px solid var(--border);
  padding:12px;
  border-radius:14px;
  background:#fafafa;
}

.kpi{
  display:grid;
  grid-template-columns:1fr 1fr;
  gap:10px;
}

.bar{
  height:10px;
  background:#e5e7eb;
  border-radius:999px;
  overflow:hidden;
}
.bar div{
  height:100%;
  width:0%;
  background:var(--brand);
}

/* ISO scroll profesional */
.iso-scroll{
  max-height:220px;
  overflow:auto;
  border:1px solid var(--border);
  border-radius:12px;
  background:#fff;
}

#iso_catalogo{
  min-width:700px;
}

.iso-item{
  padding:8px 10px;
  white-space:nowrap;
  cursor:pointer;
  border-bottom:1px solid #f1f1f1;
}
.iso-item:hover{
  background:rgba(0,87,184,.1);
}

/* Tabla scroll */
.table-scroll{
  overflow:auto;
  max-height:350px;
  border:1px solid var(--border);
  border-radius:12px;
}

table{
  min-width:1000px;
  border-collapse:collapse;
  width:100%;
}
th,td{
  padding:8px;
  border-bottom:1px solid #eee;
  white-space:nowrap;
}
th{
  background:var(--brand-soft);
  position:sticky;
  top:0;
}

.tag{
  padding:4px 8px;
  border-radius:999px;
  font-size:11px;
}

.tag.low{background:#dcfce7;color:#14532d;}
.tag.med{background:#fef9c3;color:#713f12;}
.tag.high{background:#ffedd5;color:#9a3412;}
.tag.crit{background:#fee2e2;color:#7f1d1d;}

</style>
</head>
<body>

<div class="topbar"></div>

<div class="wrap">

<h1>Calculadora de Riesgo</h1>

<div class="card">
<div class="row">
<div>
<label>ID *</label>
<input id="risk_id"/>
</div>
<div>
<label>Área</label>
<input id="area"/>
</div>
</div>

<label>Descripción</label>
<textarea id="desc"></textarea>
</div>

<div class="card">

<div class="row">
<div>
<label>Probabilidad</label>
<select id="prob"></select>
</div>
<div>
<label>Impacto</label>
<select id="impacto"></select>
</div>
</div>

<div class="row3">
<div>
<label>Confidencialidad</label>
<select id="cia_conf"></select>
</div>
<div>
<label>Integridad</label>
<select id="cia_int"></select>
</div>
<div>
<label>Disponibilidad</label>
<select id="cia_disp"></select>
</div>
</div>

<div class="row">
<div>
<label>Valor Activo</label>
<select id="valor_activo"></select>
</div>
<div>
<label>Controles</label>
<select id="controles"></select>
</div>
</div>

<hr>

<h3>Controles ISO 27001</h3>

<input id="iso_search" placeholder="Buscar..."/>

<div class="iso-scroll">
  <div id="iso_catalogo"></div>
</div>

<br>

<button class="primary" onclick="calcular()">Calcular</button>
<button onclick="agregarAlConcentrado()">Agregar al concentrado</button>

</div>

<div class="card">

<div style="display:flex;justify-content:flex-end;">
<div class="pill">
<div class="dot" id="dot"></div>
<span id="estado">Sin calcular</span>
</div>
</div>

<div class="kpi">
<div class="box">
Base: <b id="score_base">—</b>
</div>
<div class="box">
Residual: <b id="score_residual">—</b>
</div>
</div>

<br>
<div class="bar"><div id="fill"></div></div>

</div>

<div class="card">

<h3>Concentrado</h3>

<div class="table-scroll">
<table>
<thead>
<tr>
<th>ID</th>
<th>Área</th>
<th>Residual</th>
<th>Nivel</th>
</tr>
</thead>
<tbody id="tbl_body">
<tr><td colspan="4">Sin datos</td></tr>
</tbody>
</table>
</div>

</div>

</div>

<script>

const PROBABILIDAD=[1,2,3,4,5];
const IMPACTO=[1,2,3,4,5];
const CIA=[0,.1,.2,.3];

let concentrado=[];

function fillSelect(id,arr){
const sel=document.getElementById(id);
arr.forEach(v=>{
let o=document.createElement("option");
o.value=v;o.textContent=v;
sel.appendChild(o);
});
}
fillSelect("prob",PROBABILIDAD);
fillSelect("impacto",IMPACTO);
fillSelect("cia_conf",CIA);
fillSelect("cia_int",CIA);
fillSelect("cia_disp",CIA);

function clasificar(r){
if(r<=10)return["Bajo","low"];
if(r<=25)return["Medio","med"];
if(r<=50)return["Alto","high"];
return["Crítico","crit"];
}

function calcular(){
let p=+prob.value;
let i=+impacto.value;
let cia=(+cia_conf.value)+(+cia_int.value)+(+cia_disp.value);

let base=p*i;
let residual=base*(1+cia);

score_base.textContent=base;
score_residual.textContent=residual.toFixed(2);

let c=clasificar(residual);
estado.textContent=c[0];
dot.style.background=getComputedStyle(document.documentElement).getPropertyValue("--"+c[1]);

fill.style.width=Math.min(100,residual*2)+"%";
}

function agregarAlConcentrado(){
let id=risk_id.value;
if(!id)return alert("ID requerido");

let residual=parseFloat(score_residual.textContent);
let c=clasificar(residual);

concentrado.push({id,residual,nivel:c[0],cl:c[1]});
renderTabla();
}

function renderTabla(){
if(!concentrado.length){
tbl_body.innerHTML="<tr><td colspan='4'>Sin datos</td></tr>";
return;
}
tbl_body.innerHTML=concentrado.map(r=>
`<tr>
<td>${r.id}</td>
<td>${area.value}</td>
<td>${r.residual}</td>
<td><span class="tag ${r.cl}">${r.nivel}</span></td>
</tr>`
).join("");
}

</script>

</body>
</html>
