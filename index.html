<!doctype html>
<html lang="es">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Calculadora de Riesgo</title>

<style>

/* =========================
   PALETA PRINCIPAL
   ========================= */
:root{
  --brand:#445DB1;           /* Azul principal */
  --brand-dark:#344A96;      /* Azul hover */
  --brand-soft:rgba(68,93,177,.10);

  --bg:#f4f6f8;
  --card:#ffffff;
  --text:#263031;
  --muted:#7C878E;
  --border:rgba(0,0,0,.08);

  --good:#16a34a;
  --warn:#f59e0b;
  --bad:#dc2626;
  --crit:#7c3aed;
}

*{box-sizing:border-box;font-family:Segoe UI, Arial, sans-serif;}

body{
  margin:0;
  background:var(--bg);
  padding:20px;
}

.wrap{max-width:1300px;margin:auto;}

/* =========================
   HEADER AZUL
   ========================= */
header{
  background:var(--brand);
  padding:18px;
  border-radius:14px;
  color:white;
  margin-bottom:20px;
  box-shadow:0 5px 20px rgba(0,0,0,.15);
}

header h1{
  margin:0;
  font-size:26px;
}

header .sub{
  opacity:.85;
  font-size:13px;
}

/* =========================
   TARJETAS
   ========================= */
.card{
  background:var(--card);
  padding:18px;
  border-radius:14px;
  box-shadow:0 3px 14px rgba(0,0,0,.08);
  border-top:4px solid var(--brand);
}

.section-title{
  display:flex;
  justify-content:space-between;
  align-items:center;
  margin-bottom:10px;
}

.section-title h2{
  margin:0;
  color:var(--brand-dark);
  font-size:16px;
}

/* =========================
   GRID
   ========================= */
.grid{
  display:grid;
  grid-template-columns:1.2fr .8fr;
  gap:18px;
}

.layout-bottom{
  display:grid;
  grid-template-columns:1.2fr .8fr;
  gap:18px;
  margin-top:18px;
}

@media(max-width:1000px){
  .grid,.layout-bottom{grid-template-columns:1fr;}
}

/* =========================
   FORM
   ========================= */
label{font-size:12px;color:var(--muted);}
input,select,textarea{
  width:100%;
  padding:10px;
  border-radius:8px;
  border:1px solid var(--border);
  margin-top:4px;
}
textarea{min-height:70px;}

.row{display:grid;grid-template-columns:1fr 1fr;gap:12px;margin-top:12px;}
.row3{display:grid;grid-template-columns:1fr 1fr 1fr;gap:12px;margin-top:12px;}

button{
  padding:10px 14px;
  border-radius:8px;
  border:none;
  cursor:pointer;
  font-weight:600;
  margin-top:10px;
}

button.primary{
  background:var(--brand);
  color:white;
}
button.primary:hover{background:var(--brand-dark);}

button.muted{
  background:#e5e7eb;
}

button.danger{
  background:#fee2e2;
}

/* =========================
   ESTADO
   ========================= */
.pill{
  display:inline-flex;
  align-items:center;
  gap:8px;
  padding:6px 12px;
  border-radius:999px;
  background:var(--brand-soft);
  color:var(--brand-dark);
  font-weight:600;
  font-size:12px;
}

.dot{
  width:10px;height:10px;border-radius:50%;
  background:var(--brand);
}

/* =========================
   TABLA
   ========================= */
table{
  width:100%;
  border-collapse:collapse;
  font-size:12px;
}
th{
  background:var(--brand-soft);
  padding:8px;
  text-align:left;
}
td{
  padding:8px;
  border-bottom:1px solid var(--border);
}

/* =========================
   CHART
   ========================= */
canvas{width:100%;height:260px;}

</style>
</head>

<body>
<div class="wrap">

<header>
  <h1>Calculadora de Riesgo</h1>
  <div class="sub">Modelo: Base = P×I | Ajustado = Base×(1+CIA%)×Activo | Residual = Ajustado×FactorControles</div>
</header>

<div class="grid">

<!-- =========================
     FORMULARIO
     ========================= -->
<div class="card">
  <div class="section-title"><h2>Entradas</h2></div>

  <label>ID del riesgo *</label>
  <input id="risk_id"/>

  <label style="margin-top:12px;">Descripción</label>
  <textarea id="desc"></textarea>

  <div class="row">
    <div>
      <label>Probabilidad</label>
      <select id="prob">
        <option value="1">1</option>
        <option value="2">2</option>
        <option value="3" selected>3</option>
        <option value="4">4</option>
        <option value="5">5</option>
      </select>
    </div>
    <div>
      <label>Impacto</label>
      <select id="impacto">
        <option value="1">1</option>
        <option value="2">2</option>
        <option value="3" selected>3</option>
        <option value="4">4</option>
        <option value="5">5</option>
      </select>
    </div>
  </div>

  <button class="primary" onclick="calcular()">Calcular</button>
  <button class="primary" onclick="agregar()">Agregar al concentrado</button>

</div>

<!-- =========================
     RESULTADOS
     ========================= -->
<div class="card">
  <div class="section-title">
    <h2>Resultados</h2>
    <div class="pill"><span class="dot"></span><span id="estado">Sin calcular</span></div>
  </div>

  <p><b>Base:</b> <span id="base">-</span></p>
  <p><b>Residual:</b> <span id="residual">-</span></p>

</div>
</div>

<!-- =========================
     CONCENTRADO
     ========================= -->
<div class="layout-bottom">

<div class="card">
  <div class="section-title"><h2>Concentrado</h2></div>

  <button onclick="exportar()">Exportar CSV</button>

  <table id="tabla">
    <thead>
      <tr>
        <th>ID</th>
        <th>Base</th>
        <th>Residual</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>
</div>

<div class="card">
  <div class="section-title"><h2>Gráfica</h2></div>
  <canvas id="grafica"></canvas>
</div>

</div>
</div>

<script>
let datos=[];
function calcular(){
  const p=Number(document.getElementById("prob").value);
  const i=Number(document.getElementById("impacto").value);
  const base=p*i;
  const residual=base*1.2;
  document.getElementById("base").innerText=base;
  document.getElementById("residual").innerText=residual.toFixed(2);
  document.getElementById("estado").innerText=residual>15?"Alto":"Aceptable";
}
function agregar(){
  const id=document.getElementById("risk_id").value;
  const base=document.getElementById("base").innerText;
  const residual=document.getElementById("residual").innerText;
  if(!id)return;
  datos.push({id,base,residual});
  render();
}
function render(){
  const tbody=document.querySelector("#tabla tbody");
  tbody.innerHTML="";
  datos.forEach(d=>{
    tbody.innerHTML+=`<tr><td>${d.id}</td><td>${d.base}</td><td>${d.residual}</td></tr>`;
  });
}
function exportar(){
  let csv="ID,Base,Residual\n";
  datos.forEach(d=>{
    csv+=`${d.id},${d.base},${d.residual}\n`;
  });
  const blob=new Blob([csv]);
  const a=document.createElement("a");
  a.href=URL.createObjectURL(blob);
  a.download="riesgos.csv";
  a.click();
}
</script>

</body>
</html>
