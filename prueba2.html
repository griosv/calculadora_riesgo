<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Calculadora de Riesgo</title>
  <style>
    :root{
      /* Paleta inspirada en CONTPAQi */
      --brand:#005EB8;          /* Azul principal */
      --brand-dark:#004A92;     /* Azul más oscuro para hover */
      --ink:#263031;            /* Gris oscuro */
      --muted:#7C878E;          /* Gris de apoyo */
      
      /* Fondos y contraste */
      --bg:#f4f6f8;             /* Fondo general claro */
      --card:#ffffff;           /* Tarjetas blancas */
      --text:#263031;           /* Texto principal */
      --border:rgba(0,0,0,.08);

      /* Estados */
      --good:#22c55e;
      --warn:#f59e0b;
      --bad:#ef4444;
      --violet:#a855f7;
    }
    body{
      margin:0; min-height:100vh; color:var(--text);
      background:var(--bg); font-family:Arial, sans-serif;
      padding:20px;
    }
    h1{margin:0;font-size:28px;color:var(--brand);}
    .wrap{max-width:1100px;margin:auto;}
    .card{
      background:var(--card); border:1px solid var(--border);
      border-radius:10px; padding:16px; margin-bottom:20px;
      box-shadow:0 2px 4px rgba(0,0,0,.08);
    }
    label{font-size:14px;color:var(--ink);margin-bottom:6px;display:block;}
    select,input,textarea{
      width:100%;padding:10px;border:1px solid var(--border);
      border-radius:8px; margin-bottom:10px; font-size:14px;
      color:var(--ink);
    }
    select:focus,input:focus,textarea:focus{
      border-color:var(--brand); outline:none;
      box-shadow:0 0 4px rgba(0,94,184,.3);
    }
    .btn{cursor:pointer;padding:10px 16px;border:none;border-radius:8px;
         background:var(--brand);color:#fff;font-weight:700;font-size:14px;}
    .btn:hover{background:var(--brand-dark);}
    .row{display:grid;grid-template-columns:1fr 1fr;gap:12px;}
    .divider{height:1px;background:var(--border);margin:16px 0;}
    .small{font-size:12px;color:var(--muted);}
    .results{margin-top:10px;}
    .result-box{padding:12px;border:1px solid var(--border);border-radius:8px;margin-bottom:10px;}
    .bar{height:10px;border-radius:6px;background:rgba(0,0,0,.1);margin-top:6px;}
    .bar>div{height:100%;width:0%;background:var(--brand);}
  </style>
</head>
<body>

<div class="wrap">
  <h1>Calculadora de Riesgo</h1>
  <p class="small">Modelo con criterios de Probabilidad, Impacto, Modificador CIA, Valor de activo y Controles existentes.</p>

  <div class="card">
    <h3>Entradas</h3>

    <div class="row">
      <div>
        <label>Probabilidad</label>
        <select id="prob"></select>
        <div class="small" id="prob_det"></div>
      </div>
      <div>
        <label>Impacto</label>
        <select id="impacto"></select>
        <div class="small" id="impacto_det"></div>
      </div>
    </div>

    <div class="divider"></div>

    <h4>Impacto en Tríada CIA (suma de %)</h4>
    <div class="row">
      <div><label>Confidencialidad</label><select id="cia_conf"></select></div>
      <div><label>Integridad</label><select id="cia_int"></select></div>
      <div><label>Disponibilidad</label><select id="cia_disp"></select></div>
    </div>

    <div class="divider"></div>

    <div class="row">
      <div>
        <label>Valor del Activo</label>
        <select id="valor_activo"></select>
      </div>
      <div>
        <label>Controles Existentes</label>
        <select id="controles"></select>
      </div>
    </div>

    <div class="divider"></div>

    <label>ID / Folio (opcional)</label><input id="folio" placeholder="Ej. R-2026-001" />
    <label>Área / Proceso (opcional)</label><input id="area" placeholder="Ej. TI / Desarrollo" />
    <label>Descripción (opcional)</label><textarea id="desc" placeholder="Detalle del riesgo..."></textarea>

    <div style="margin-top:12px;">
      <button class="btn" onclick="calcular()">Calcular</button>
      <button class="btn" style="background:var(--muted);" onclick="limpiar()">Limpiar</button>
    </div>
  </div>

  <div class="card">
    <h3>Resultados</h3>

    <div class="result-box">
      <strong>Riesgo Base (P×I):</strong> <span id="score_base">—</span><br>
      <strong>Riesgo Ajustado:</strong> <span id="score_ajustado">—</span><br>
      <strong>Riesgo Residual:</strong> <span id="score_residual">—</span>
    </div>

    <div class="result-box">
      <strong>Modificador CIA:</strong> <span id="mod_cia">—</span> |
      <strong>Multiplicador Activo:</strong> <span id="mod_activo">—</span> |
      <strong>Factor Controles:</strong> <span id="mod_controles">—</span>
    </div>

    <div class="result-box">
      <strong>Clasificación:</strong> <span id="nivel">—</span><br>
      <strong>Acción prioritaria:</strong> <span id="accion_prior">—</span>
    </div>

    <div class="bar"><div id="fill"></div></div>
    <p class="small" style="text-align:right;"><span id="pct">0%</span></p>

    <div class="divider"></div>

    <h4>Recomendaciones</h4>
    <ul id="recs"></ul>
  </div>

</div>

<script>
  const PROBABILIDAD = [
    { n:1,label:"1 - Raro (<1% anual)",detalle:"Muy poco probable (>5 años)"},
    { n:2,label:"2 - Improbable (1–10%)",detalle:"Poco probable (2–5 años)"},
    { n:3,label:"3 - Posible (10–50%)",detalle:"Podría ocurrir (1–5 años)"},
    { n:4,label:"4 - Probable (50–90%)",detalle:"Probable (6–12 meses)"},
    { n:5,label:"5 - Casi seguro (>90%)",detalle:"Muy probable (<6 meses)"}
  ];
  const IMPACTO = [
    { n:1,label:"1 - Insignificante (<$10K)",detalle:"Impacto menor"},
    { n:2,label:"2 - Menor ($10K–$100K)",detalle:"Impacto bajo/moderado"},
    { n:3,label:"3 - Moderado ($100K–$1M)",detalle:"Impacto significativo"},
    { n:4,label:"4 - Mayor ($1M–$10M)",detalle:"Impacto alto"},
    { n:5,label:"5 - Catastrófico (>$10M)",detalle:"Impacto crítico"}
  ];
  const CIA = [
    { key:"Ninguno",label:"Ninguno",pct:0.00 },
    { key:"Bajo",label:"Bajo",pct:0.10 },
    { key:"Medio",label:"Medio",pct:0.20 },
    { key:"Alto",label:"Alto",pct:0.30 }
  ];
  const VALOR_ACTIVO = [
    { key:"No especificado",label:"No especificado",mult:1.0 },
    { key:"Valor Bajo",label:"Valor Bajo",mult:1.0 },
    { key:"Valor Medio",label:"Valor Medio",mult:1.2 },
    { key:"Valor Alto",label:"Valor Alto",mult:1.3 },
    { key:"Crítico",label:"Crítico/Esencial",mult:1.5 }
  ];
  const CONTROLES = [
    { key:"No Especificado",label:"No Especificado",factor:1.0 },
    { key:"Ninguno Implementado",label:"Ninguno Implementado",factor:1.0 },
    { key:"Débil/Parcial",label:"Débil/Parcial",factor:0.8 },
    { key:"Moderado",label:"Moderado",factor:0.6 },
    { key:"Fuerte/Integral",label:"Fuerte/Integral",factor:0.4 }
  ];

  function fill(selId,arr,byN=true){const s=document.getElementById(selId);s.innerHTML="";arr.forEach(o=>{const opt=document.createElement("option");opt.value=byN?o.n:o.key;opt.textContent=o.label;s.appendChild(opt);});}
  function getByN(arr,n){return arr.find(x=>x.n===n);} 
  function getByKey(arr,k){return arr.find(x=>x.key===k);}

  function clasificar(score){
    if(score<=10) return {nivel:"Bajo",accion:"Aceptar / Revisar",color:"--good",rec:["Aceptar riesgo con revisión periódica","Documentar registro"]};
    if(score<=25) return {nivel:"Medio",accion:"Monitorear / Revisar",color:"--warn",rec:["Documentar registro","Mejorar controles"]};
    if(score<=50) return {nivel:"Alto",accion:"Mitigar",color:"--bad",rec:["Implementar controles","Redundancia"]};
    return {nivel:"Crítico",accion:"Acción inmediata",color:"--violet",rec:["Escalar","Detener hasta mitigar"]};
  }

  function calcular(){
    const p=Number(document.getElementById("prob").value);
    const i=Number(document.getElementById("impacto").value);
    const ciaC=getByKey(CIA,document.getElementById("cia_conf").value);
    const ciaI=getByKey(CIA,document.getElementById("cia_int").value);
    const ciaD=getByKey(CIA,document.getElementById("cia_disp").value);
    const activo=getByKey(VALOR_ACTIVO,document.getElementById("valor_activo").value);
    const controles=getByKey(CONTROLES,document.getElementById("controles").value);

    const base=p*i;
    const ciaPct=(ciaC.pct+ciaI.pct+ciaD.pct);
    const adj=base*(1+ciaPct)*activo.mult;
    const residual=adj*controles.factor;

    document.getElementById("score_base").textContent=base.toFixed(2);
    document.getElementById("score_ajustado").textContent=adj.toFixed(2);
    document.getElementById("score_residual").textContent=residual.toFixed(2);

    document.getElementById("mod_cia").textContent= "+"+Math.round(ciaPct*100)+"%";
    document.getElementById("mod_activo").textContent=activo.mult.toFixed(1)+"x";
    document.getElementById("mod_controles").textContent=controles.factor.toFixed(1);

    const result=clasificar(residual);
    document.getElementById("nivel").textContent=result.nivel;
    document.getElementById("accion_prior").textContent=result.accion;
    document.getElementById("recs").innerHTML="";
    result.rec.forEach(t=>document.getElementById("recs").innerHTML+=`<li>${t}</li>`);

    const pct=Math.min(100,Math.round((residual/75)*100));
    document.getElementById("fill").style.width=pct+"%";
    document.getElementById("pct").textContent=pct+"%";
  }

  function limpiar(){
    fill("prob",PROBABILIDAD);
    fill("impacto",IMPACTO);
    fill("cia_conf",CIA,false);
    fill("cia_int",CIA,false);
    fill("cia_disp",CIA,false);
    fill("valor_activo",VALOR_ACTIVO,false);
    fill("controles",CONTROLES,false);
  }

  fill("prob",PROBABILIDAD);
  fill("impacto",IMPACTO);
  fill("cia_conf",CIA,false);
  fill("cia_int",CIA,false);
  fill("cia_disp",CIA,false);
  fill("valor_activo",VALOR_ACTIVO,false);
  fill("controles",CONTROLES,false);
</script>

</body>
</html>
