<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Calculadora de Riesgo (Criterios 1–5 + CIA + Activo + Controles)</title>
  <style>
    :root{
      --bg:#0b1220; --card:#121b2e; --muted:#93a4c7; --text:#eaf0ff;
      --border:rgba(255,255,255,.10);
      --good:#22c55e; --warn:#f59e0b; --bad:#ef4444; --violet:#a855f7;
    }
    *{box-sizing:border-box;font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial;}
    body{
      margin:0; min-height:100vh; color:var(--text);
      background:
        radial-gradient(1200px 650px at 15% 0%, rgba(110,231,255,.14), transparent 55%),
        radial-gradient(900px 520px at 92% 10%, rgba(167,139,250,.14), transparent 50%),
        var(--bg);
      padding:26px;
    }
    .wrap{max-width:1200px; margin:0 auto;}
    header{display:flex; gap:14px; align-items:flex-end; justify-content:space-between; margin-bottom:16px;}
    h1{margin:0; font-size:26px; letter-spacing:.2px;}
    .sub{margin:6px 0 0; color:var(--muted); font-size:13px; line-height:1.35;}
    .pill{
      display:inline-flex; align-items:center; gap:8px;
      border:1px solid var(--border); border-radius:999px;
      padding:8px 12px; background:rgba(0,0,0,.18);
      white-space:nowrap;
    }
    .dot{width:10px;height:10px;border-radius:50%; background:#94a3b8;}
    .grid{display:grid; grid-template-columns: 1.15fr .85fr; gap:14px;}
    .card{
      background: linear-gradient(180deg, rgba(255,255,255,.05), rgba(255,255,255,.02));
      border:1px solid var(--border);
      border-radius:18px; padding:16px;
      box-shadow: 0 10px 30px rgba(0,0,0,.25);
      backdrop-filter: blur(10px);
    }
    .section-title{display:flex; justify-content:space-between; align-items:baseline; gap:10px; margin-bottom:10px;}
    .section-title h2{margin:0; font-size:16px;}
    .hint{color:var(--muted); font-size:12px; line-height:1.35;}
    .row{display:grid; grid-template-columns: 1fr 1fr; gap:12px; margin-top:12px;}
    .row3{display:grid; grid-template-columns: 1fr 1fr 1fr; gap:12px; margin-top:12px;}
    label{display:block; color:var(--muted); font-size:12px; margin-bottom:6px;}
    input, select, textarea{
      width:100%; padding:12px 12px; border-radius:12px;
      border:1px solid var(--border);
      background:rgba(0,0,0,.18); color:var(--text); outline:none;
    }
    textarea{min-height:86px; resize:vertical;}
    input:focus, select:focus, textarea:focus{border-color: rgba(110,231,255,.50); box-shadow: 0 0 0 3px rgba(110,231,255,.12);}
    .btns{display:flex; gap:10px; margin-top:14px; flex-wrap:wrap;}
    button{
      cursor:pointer; border:1px solid var(--border);
      background: rgba(255,255,255,.06);
      color:var(--text); padding:12px 14px; border-radius:12px; font-weight:700;
    }
    button.primary{
      background: linear-gradient(90deg, rgba(110,231,255,.20), rgba(167,139,250,.18));
    }
    .kpi{display:grid; grid-template-columns:1fr 1fr; gap:10px; margin-top:10px;}
    .box{
      border:1px solid var(--border); border-radius:14px; padding:12px;
      background:rgba(0,0,0,.16);
    }
    .box .t{color:var(--muted); font-size:12px;}
    .box .v{margin-top:4px; font-size:22px; font-weight:900;}
    .box .s{margin-top:6px; font-size:12px; color:var(--muted); line-height:1.35;}
    .bar{height:12px; border-radius:999px; background:rgba(255,255,255,.10); overflow:hidden; border:1px solid var(--border);}
    .bar > div{height:100%; width:0%;}
    .divider{height:1px;background:rgba(255,255,255,.08); margin:14px 0;}
    .small{font-size:12px; color:var(--muted); line-height:1.35;}
    .mono{font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, monospace;}
    ul{margin:8px 0 0 18px; padding:0;}
    li{color:var(--muted); margin:6px 0;}
    @media (max-width: 980px){ .grid{grid-template-columns:1fr;} }
  </style>
</head>

<body>
  <div class="wrap">
    <header>
      <div>
        <h1>Calculadora de Riesgo</h1>
        <div class="sub">
          Criterios 1–5 + Modificador <span class="mono">CIA</span> (en %) + Multiplicador de <span class="mono">Activo</span> + Ajuste por <span class="mono">Controles</span>.<br/>
          Fórmula: <span class="mono">Base = P×I</span> · <span class="mono">Ajustado = Base×(1+CIA%)×Activo</span> · <span class="mono">Residual = Ajustado×FactorControles</span>
        </div>
      </div>
      <div class="pill">
        <span class="dot" id="dot"></span>
        <strong id="estado">Sin calcular</strong>
      </div>
    </header>

    <div class="grid">

      <!-- Inputs -->
      <div class="card">
        <div class="section-title">
          <h2>Entradas</h2>
          <div class="hint">Selecciona criterios y presiona <b>Calcular</b>.</div>
        </div>

        <div class="row">
          <div>
            <label>Probabilidad</label>
            <select id="prob"></select>
            <div class="small" id="prob_det"></div>
          </div>
          <div>
            <label>Impacto</label>
            <select id="impacto"></select>
            <div class="small" id="impacto_det"></div>
          </div>
        </div>

        <div class="divider"></div>

        <div class="section-title">
          <h2>Impacto en Tríada CIA</h2>
          <div class="hint">Suma porcentajes. Ej: Alto+Alto+Alto = <b>+90%</b></div>
        </div>

        <div class="row3">
          <div>
            <label>Confidencialidad</label>
            <select id="cia_conf"></select>
          </div>
          <div>
            <label>Integridad</label>
            <select id="cia_int"></select>
          </div>
          <div>
            <label>Disponibilidad</label>
            <select id="cia_disp"></select>
          </div>
        </div>

        <div class="divider"></div>

        <div class="row">
          <div>
            <label>Valor del Activo</label>
            <select id="valor_activo"></select>
          </div>
          <div>
            <label>Controles Existentes</label>
            <select id="controles"></select>
          </div>
        </div>

        <div class="row">
          <div>
            <label>ID / Folio (opcional)</label>
            <input id="folio" placeholder="Ej. R-2026-001" />
          </div>
          <div>
            <label>Área / Proceso (opcional)</label>
            <input id="area" placeholder="Ej. TI / Desarrollo" />
          </div>
        </div>

        <div style="margin-top:12px;">
          <label>Descripción (opcional)</label>
          <textarea id="desc" placeholder="Ej. Riesgo de acceso no autorizado..."></textarea>
        </div>

        <div class="btns">
          <button class="primary" onclick="calcular()">Calcular</button>
          <button onclick="limpiar()">Limpiar</button>
        </div>

        <div class="hint" style="margin-top:10px;">
          Si quieres que sea idéntico al 100% a tu “calculadora ejemplo”, me dices los umbrales exactos de Bajo/Medio/Alto/Crítico y los pongo igual.
        </div>
      </div>

      <!-- Resultados -->
      <div class="card">
        <div class="section-title">
          <h2>Resultados</h2>
          <div class="hint">Vista ejecutiva y recomendaciones.</div>
        </div>

        <div class="kpi">
          <div class="box">
            <div class="t">Riesgo Base (P×I)</div>
            <div class="v" id="score_base">—</div>
            <div class="s">Rango 1–25</div>
          </div>
          <div class="box">
            <div class="t">Riesgo Ajustado</div>
            <div class="v" id="score_ajustado">—</div>
            <div class="s">Incluye CIA y activo</div>
          </div>
        </div>

        <div class="box" style="margin-top:10px;">
          <div class="t">Modificadores de Riesgo</div>
          <div class="s">
            Modificador CIA: <b id="mod_cia">—</b> &nbsp;|&nbsp;
            Multiplicador de Activo: <b id="mod_activo">—</b> &nbsp;|&nbsp;
            Factor Controles: <b id="mod_controles">—</b>
          </div>
        </div>

        <div class="divider"></div>

        <div class="kpi">
          <div class="box">
            <div class="t">Riesgo Residual</div>
            <div class="v" id="score_residual">—</div>
            <div class="s" id="nivel">Clasificación: —</div>
          </div>
          <div class="box">
            <div class="t">Acción Prioritaria</div>
            <div class="v" style="font-size:14px;font-weight:900;" id="accion_prior">—</div>
            <div class="s">Basado en el residual</div>
          </div>
        </div>

        <div style="margin-top:12px;">
          <div class="small" style="display:flex;justify-content:space-between;margin-bottom:6px;">
            <span>Indicador visual</span>
            <span id="pct">0%</span>
          </div>
          <div class="bar"><div id="fill"></div></div>
          <div class="hint" id="out_detalle" style="margin-top:10px;">—</div>
        </div>

        <div class="divider"></div>

        <div class="section-title">
          <h2>Recomendaciones</h2>
          <div class="hint">Lista sugerida según el nivel.</div>
        </div>
        <ul id="recs"></ul>
      </div>

    </div>
  </div>

  <script>
    // ===== Criterios según tus screenshots =====
    const PROBABILIDAD = [
      { n: 1, label: "1 - Raro (<1% anual)", detalle: "Muy poco probable. Frecuencia esperada: >5 años." },
      { n: 2, label: "2 - Improbable (1-10% anual)", detalle: "Poco probable. Frecuencia esperada: 2-5 años." },
      { n: 3, label: "3 - Posible (10-50% anual)", detalle: "Podría ocurrir. Frecuencia esperada: 1-5 años." },
      { n: 4, label: "4 - Probable (50-90% anual)", detalle: "Probable. Frecuencia esperada: 6-12 meses." },
      { n: 5, label: "5 - Casi Seguro (>90% anual)", detalle: "Altamente probable. Frecuencia esperada: <6 meses." },
    ];

    const IMPACTO = [
      { n: 1, label: "1 - Insignificante (<$10K pérdida)", detalle: "Impacto menor. Manejo local." },
      { n: 2, label: "2 - Menor ($10K-$100K pérdida)", detalle: "Impacto bajo/moderado." },
      { n: 3, label: "3 - Moderado ($100K-$1M pérdida)", detalle: "Impacto significativo, requiere gestión." },
      { n: 4, label: "4 - Mayor ($1M-$10M pérdida)", detalle: "Impacto alto, afecta objetivos críticos." },
      { n: 5, label: "5 - Catastrófico (>$10M pérdida)", detalle: "Impacto extremo, afecta continuidad." },
    ];

    // Para lograr +90% con Alto/Alto/Alto:
    // Ninguno=0%, Bajo=10%, Medio=20%, Alto=30%
    const CIA = [
      { key: "Ninguno", label: "Ninguno", pct: 0.00 },
      { key: "Bajo",    label: "Bajo",    pct: 0.10 },
      { key: "Medio",   label: "Medio",   pct: 0.20 },
      { key: "Alto",    label: "Alto",    pct: 0.30 },
    ];

    const VALOR_ACTIVO = [
      { key: "No especificado", label: "No especificado", mult: 1.0 },
      { key: "Valor Bajo", label: "Valor Bajo", mult: 1.0 },
      { key: "Valor Medio", label: "Valor Medio", mult: 1.2 },
      { key: "Valor Alto", label: "Valor Alto", mult: 1.3 },
      { key: "Crítico/Esencial para la Misión", label: "Crítico/Esencial para la Misión", mult: 1.5 },
    ];

    const CONTROLES = [
      { key: "No Especificado", label: "No Especificado", factor: 1.0 },
      { key: "Ninguno Implementado", label: "Ninguno Implementado", factor: 1.0 },
      { key: "Débil/Parcial", label: "Débil/Parcial", factor: 0.8 },
      { key: "Moderado", label: "Moderado", factor: 0.6 },
      { key: "Fuerte/Integral", label: "Fuerte/Integral", factor: 0.4 },
    ];

    // ===== Helpers =====
    function fillSelectByN(selId, arr){
      const sel = document.getElementById(selId);
      sel.innerHTML = "";
      arr.forEach(o=>{
        const op = document.createElement("option");
        op.value = o.n;
        op.textContent = o.label;
        sel.appendChild(op);
      });
      sel.value = arr[2]?.n ?? arr[0]?.n ?? 1; // default a 3 si existe
    }

    function fillSelectByKey(selId, arr, defaultKey){
      const sel = document.getElementById(selId);
      sel.innerHTML = "";
      arr.forEach(o=>{
        const op = document.createElement("option");
        op.value = o.key;
        op.textContent = o.label;
        sel.appendChild(op);
      });
      sel.value = defaultKey ?? arr[0]?.key ?? "";
    }

    function getByN(arr, n){ return arr.find(x => x.n === n); }
    function getByKey(arr, k){ return arr.find(x => x.key === k); }

    function colorDot(kind){
      const dot = document.getElementById("dot");
      const fill = document.getElementById("fill");
      const root = getComputedStyle(document.documentElement);
      const c = kind === "good" ? root.getPropertyValue("--good")
              : kind === "warn" ? root.getPropertyValue("--warn")
              : kind === "bad"  ? root.getPropertyValue("--bad")
              : root.getPropertyValue("--violet");
      dot.style.background = c.trim();
      fill.style.background = c.trim();
    }

    // Clasificación (ajusta umbrales si lo quieres igual exacto al ejemplo)
    function clasificar(scoreResidual){
      // Umbrales recomendados para residual (depende de tu apetito de riesgo)
      if (scoreResidual <= 10) return {
        nivel:"Bajo",
        accion:"Accept/Review",
        color:"good",
        rec:["Accept risk with periodic review","Document in risk register"]
      };
      if (scoreResidual <= 25) return {
        nivel:"Medio",
        accion:"Monitor/Review",
        color:"warn",
        rec:["Document in risk register","Plan quick improvements to controls"]
      };
      if (scoreResidual <= 50) return {
        nivel:"Alto",
        accion:"Mitigate",
        color:"bad",
        rec:[
          "Implement data encryption and access controls",
          "Add integrity monitoring and validation controls",
          "Implement redundancy and disaster recovery measures"
        ]
      };
      return {
        nivel:"Crítico",
        accion:"Immediate Action",
        color:"vio",
        rec:[
          "Escalate to management immediately",
          "Stop/avoid activity until treated",
          "Implement compensating controls urgently"
        ]
      };
    }

    function calcular(){
      const p = Number(document.getElementById("prob").value);
      const i = Number(document.getElementById("impacto").value);

      const ciaC = getByKey(CIA, document.getElementById("cia_conf").value);
      const ciaI = getByKey(CIA, document.getElementById("cia_int").value);
      const ciaD = getByKey(CIA, document.getElementById("cia_disp").value);

      const activo = getByKey(VALOR_ACTIVO, document.getElementById("valor_activo").value);
      const controles = getByKey(CONTROLES, document.getElementById("controles").value);

      const base = p * i; // 1..25
      const ciaPct = (ciaC?.pct || 0) + (ciaI?.pct || 0) + (ciaD?.pct || 0); // ej. 0.90
      const multActivo = activo?.mult || 1.0;
      const factorCtrl = controles?.factor ?? 1.0;

      const scoreAjustado = base * (1 + ciaPct) * multActivo;
      const scoreResidual = scoreAjustado * factorCtrl;

      // Detalles prob/impacto
      const pObj = getByN(PROBABILIDAD, p);
      const iObj = getByN(IMPACTO, i);
      document.getElementById("prob_det").textContent = pObj?.detalle || "";
      document.getElementById("impacto_det").textContent = iObj?.detalle || "";

      // Scores
      document.getElementById("score_base").textContent = base.toFixed(2);
      document.getElementById("score_ajustado").textContent = scoreAjustado.toFixed(2);
      document.getElementById("score_residual").textContent = scoreResidual.toFixed(2);

      // Modificadores
      document.getElementById("mod_cia").textContent = `+${Math.round(ciaPct*100)}%`;
      document.getElementById("mod_activo").textContent = `${multActivo.toFixed(1)}x`;
      document.getElementById("mod_controles").textContent = `${factorCtrl.toFixed(1)}`;

      // Clasificación + recomendaciones
      const c = clasificar(scoreResidual);
      document.getElementById("nivel").textContent = `Clasificación: ${c.nivel}`;
      document.getElementById("accion_prior").textContent = c.accion;

      const ul = document.getElementById("recs");
      ul.innerHTML = "";
      c.rec.forEach(t=>{
        const li = document.createElement("li");
        li.textContent = t;
        ul.appendChild(li);
      });

      // Barra visual (normalización)
      const max = 75; // ajusta si quieres, para que el % sea más/menos estricto
      const pct = Math.max(0, Math.min(100, Math.round((scoreResidual / max) * 100)));
      document.getElementById("pct").textContent = pct + "%";
      document.getElementById("fill").style.width = pct + "%";

      // Color y estado
      colorDot(c.color);
      document.getElementById("estado").textContent = c.accion;

      // Detalle
      const folio = document.getElementById("folio").value || "—";
      const area = document.getElementById("area").value || "—";
      document.getElementById("out_detalle").textContent =
        `Folio: ${folio} | Área: ${area} | Base: ${p}×${i}=${base.toFixed(2)} | CIA: +${Math.round(ciaPct*100)}% | Activo: ${multActivo.toFixed(1)}x | Controles: ${factorCtrl.toFixed(1)} | Residual: ${scoreResidual.toFixed(2)}`;
    }

    function limpiar(){
      document.getElementById("folio").value = "";
      document.getElementById("area").value = "";
      document.getElementById("desc").value = "";

      // Defaults cercanos a tu ejemplo visual
      document.getElementById("prob").value = 3;
      document.getElementById("impacto").value = 3;
      document.getElementById("cia_conf").value = "Alto";
      document.getElementById("cia_int").value = "Alto";
      document.getElementById("cia_disp").value = "Alto";
      document.getElementById("valor_activo").value = "Crítico/Esencial para la Misión";
      document.getElementById("controles").value = "No Especificado";

      document.getElementById("prob_det").textContent = "";
      document.getElementById("impacto_det").textContent = "";

      document.getElementById("score_base").textContent = "—";
      document.getElementById("score_ajustado").textContent = "—";
      document.getElementById("score_residual").textContent = "—";
      document.getElementById("nivel").textContent = "Clasificación: —";
      document.getElementById("accion_prior").textContent = "—";
      document.getElementById("mod_cia").textContent = "—";
      document.getElementById("mod_activo").textContent = "—";
      document.getElementById("mod_controles").textContent = "—";

      document.getElementById("pct").textContent = "0%";
      document.getElementById("fill").style.width = "0%";
      document.getElementById("out_detalle").textContent = "—";
      document.getElementById("recs").innerHTML = "";

      document.getElementById("estado").textContent = "Sin calcular";
      document.getElementById("dot").style.background = "#94a3b8";
    }

    // Init
    fillSelectByN("prob", PROBABILIDAD);
    fillSelectByN("impacto", IMPACTO);
    fillSelectByKey("cia_conf", CIA, "Alto");
    fillSelectByKey("cia_int", CIA, "Alto");
    fillSelectByKey("cia_disp", CIA, "Alto");
    fillSelectByKey("valor_activo", VALOR_ACTIVO, "Crítico/Esencial para la Misión");
    fillSelectByKey("controles", CONTROLES, "No Especificado");

    // Actualiza detalles al cambiar
    document.getElementById("prob").addEventListener("change", ()=> {
      const pObj = getByN(PROBABILIDAD, Number(document.getElementById("prob").value));
      document.getElementById("prob_det").textContent = pObj?.detalle || "";
    });
    document.getElementById("impacto").addEventListener("change", ()=> {
      const iObj = getByN(IMPACTO, Number(document.getElementById("impacto").value));
      document.getElementById("impacto_det").textContent = iObj?.detalle || "";
    });

    limpiar();
  </script>
</body>
</html>
